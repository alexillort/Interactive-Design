<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Efecto Líquido con p5.js (Corregido)</title>
    <style>
        body { margin: 0; overflow: hidden; }
        /* Centramos el contenedor principal */
        main { display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #000; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
</head>
<body>
    <main id="main"></main>

    <script type="module">
        import { HandLandmarker, FilesetResolver } from "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.14";

        let handLandmarker;
        let lastVideoTime = -1;
        let detections = null;

        async function createHandLandmarker() {
            const vision = await FilesetResolver.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.14/wasm");
            handLandmarker = await HandLandmarker.createFromOptions(vision, { 
                baseOptions: { modelAssetPath: `https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task`, delegate: "GPU" },
                runningMode: "VIDEO", numHands: 2 
            });
        }
        
        main();

        async function main() {
            await createHandLandmarker();
            new p5(sketch);
        }

        const sketch = (p) => {
            let video;
            let gooeyLayer;

            p.setup = () => {
                // p5.js ahora encontrará el contenedor <main id="main">
                p.createCanvas(1280, 720).parent('main');
                video = p.createCapture(p.VIDEO);
                video.size(p.width, p.height);
                video.hide();

                gooeyLayer = p.createGraphics(p.width, p.height);
            };

            p.draw = () => {
                if (video.elt.readyState === 4 && handLandmarker) {
                    if (video.elt.currentTime !== lastVideoTime) {
                        lastVideoTime = video.elt.currentTime;
                        detections = handLandmarker.detectForVideo(video.elt, Date.now());
                    }
                }
                
                p.push();
                p.translate(p.width, 0);
                p.scale(-1, 1);
                p.image(video, 0, 0, p.width, p.height);
                p.pop();

                gooeyLayer.clear();
                gooeyLayer.noStroke();
                gooeyLayer.fill(255, 255, 255);
                
                if (detections && detections.landmarks) {
                    for (const landmarks of detections.landmarks) {
                        for (const point of landmarks) {
                            gooeyLayer.ellipse(point.x * p.width, point.y * p.height, 80, 80);
                        }
                    }
                }

                gooeyLayer.filter(p.BLUR, 25);
                gooeyLayer.filter(p.THRESHOLD, 0.3);

                p.push();
                p.translate(p.width, 0);
                p.scale(-1, 1);
                p.drawingContext.globalCompositeOperation = 'screen';
                p.image(gooeyLayer, 0, 0);
                p.pop();
            };
        };
    </script>
</body>
</html>